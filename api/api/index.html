<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI –¢–µ—Å—Ç –ø–æ–¥–±–æ—Ä–∞ –∞—Ä–æ–º–∞—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7ec 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #8e9eab 0%, #eef2f3 100%);
            padding: 30px;
            text-align: center;
            color: #2c3e50;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .ai-badge {
            display: inline-block;
            background: rgba(255,255,255,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .question {
            font-size: 20px;
            margin-bottom: 25px;
            color: #2c3e50;
            line-height: 1.4;
            min-height: 60px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .option {
            padding: 15px 20px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .option.selected {
            background: #e3f2fd;
            border-color: #8e9eab;
            box-shadow: 0 5px 15px rgba(142, 158, 171, 0.2);
        }
        
        .progress {
            text-align: center;
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #8e9eab 0%, #6d7b88 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8e9eab;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        .result-section {
            display: none;
            text-align: center;
        }
        
        .result-image {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #8e9eab, #eef2f3);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            animation: pulse 2s infinite;
        }
        
        .result-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .result-description {
            line-height: 1.6;
            color: #555;
            margin-bottom: 25px;
            text-align: left;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #8e9eab;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #dc3545;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .success-message {
            background: #d1edff;
            color: #055160;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #0dcaf0;
            display: none;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 12px;
            border-top: 1px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ AI –¢–µ—Å—Ç –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –∞—Ä–æ–º–∞—Ç–∞</h1>
            <p>–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –ø–æ–¥–±–µ—Ä–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä—Ñ—é–º –∏–º–µ–Ω–Ω–æ –¥–ª—è –≤–∞—Å</p>
            <div class="ai-badge">ü§ñ Powered by AI</div>
        </div>
        
        <div class="content">
            <div class="success-message" id="successMessage">
                ‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω. –û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –Ω–∏–∂–µ.
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            
            <div id="questionSection">
                <div class="progress" id="progressText">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 8</div>
                <div class="question" id="questionText">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞...</div>
                <div class="options" id="optionsContainer"></div>
                <button id="nextBtn" onclick="nextQuestion()" disabled>–î–∞–ª–µ–µ</button>
            </div>
            
            <div class="loading" id="loadingSection">
                <div class="spinner"></div>
                <p id="loadingText">–ò–ò –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–æ–ø—Ä–æ—Å...</p>
            </div>
            
            <div class="result-section" id="resultSection">
                <div class="result-image">‚ú®</div>
                <h2 class="result-title">–í–∞—à –∏–¥–µ–∞–ª—å–Ω—ã–π –∞—Ä–æ–º–∞—Ç</h2>
                <div class="result-description" id="resultDescription"></div>
                <button onclick="restartTest()">üîÑ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –µ—â–µ —Ä–∞–∑</button>
            </div>
        </div>

        <div class="footer">
            –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω —Å –ø–æ–º–æ—â—å—é –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ ‚Ä¢ –í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
        </div>
    </div>

    <script>
        // üîß –í–ê–ñ–ù–û: –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ URL –ù–ê –í–ê–® VERCEL URL –ü–û–°–õ–ï –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø
        // –ü—Ä–∏–º–µ—Ä: https://perfume-test.vercel.app
        const SERVER_URL = 'https://your-project.vercel.app';
        
        let currentQuestion = 0;
        let answers = [];
        const totalQuestions = 8;

        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = async function() {
            showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞...');
            await generateQuestion();
        };

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–∞
        async function generateQuestion() {
            try {
                const response = await fetch(`${SERVER_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        answers: answers
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                }

                displayQuestion(data.choices[0].message.content);
                showSuccess('–í–æ–ø—Ä–æ—Å –∑–∞–≥—Ä—É–∂–µ–Ω!');
                
            } catch (error) {
                console.error('Error:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–æ–ø—Ä–æ—Å–∞: ' + error.message);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞
        function displayQuestion(content) {
            hideLoading();
            
            const lines = content.split('\n').filter(line => line.trim());
            let question = '–ö–∞–∫–æ–π –∞—Ä–æ–º–∞—Ç –æ—Ç—Ä–∞–∂–∞–µ—Ç –≤–∞—à—É –ª–∏—á–Ω–æ—Å—Ç—å?';
            const options = [
                '–°–≤–µ–∂–∏–π –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π', 
                '–¶–≤–µ—Ç–æ—á–Ω—ã–π –∏ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π', 
                '–î—Ä–µ–≤–µ—Å–Ω—ã–π –∏ –∑–∞–≥–∞–¥–æ—á–Ω—ã–π', 
                '–ü—Ä—è–Ω—ã–π –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω—ã–π'
            ];

            // –£–º–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –ò–ò
            let foundOptions = 0;
            for (const line of lines) {
                const trimmedLine = line.trim();
                
                // –ò—â–µ–º –≤–æ–ø—Ä–æ—Å (—Å—Ç—Ä–æ–∫–∞ –±–µ–∑ A) B) C) D) –≤ –Ω–∞—á–∞–ª–µ)
                if (!trimmedLine.match(/^[A-D][).]/) && trimmedLine) {
                    // –£–±–∏—Ä–∞–µ–º "–í–æ–ø—Ä–æ—Å:" –µ—Å–ª–∏ –µ—Å—Ç—å
                    const cleanLine = trimmedLine.replace(/^–í–æ–ø—Ä–æ—Å:\s*/i, '');
                    if (cleanLine && question === '–ö–∞–∫–æ–π –∞—Ä–æ–º–∞—Ç –æ—Ç—Ä–∞–∂–∞–µ—Ç –≤–∞—à—É –ª–∏—á–Ω–æ—Å—Ç—å?') {
                        question = cleanLine;
                    }
                }
                
                // –ò—â–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
                const optionMatch = trimmedLine.match(/^([A-D])[).]\s*(.+)$/i);
                if (optionMatch) {
                    const index = optionMatch[1].toUpperCase().charCodeAt(0) - 65; // A=0, B=1, C=2, D=3
                    if (index >= 0 && index < 4) {
                        options[index] = optionMatch[2].trim();
                        foundOptions++;
                    }
                }
            }

            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ A) B) C) D), –ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π –ø–∞—Ä—Å–∏–Ω–≥
            if (foundOptions === 0) {
                for (let i = 0; i < Math.min(4, lines.length - 1); i++) {
                    const line = lines[i + 1] || '';
                    if (line.trim() && !line.match(/^[A-D][).]/)) {
                        options[i] = line.trim();
                    }
                }
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('questionText').textContent = question;
            document.getElementById('progressText').textContent = `–í–æ–ø—Ä–æ—Å ${currentQuestion + 1} –∏–∑ ${totalQuestions}`;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <strong>${String.fromCharCode(65 + index)})</strong> ${option}
                `;
                optionElement.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionElement);
            });

            document.getElementById('nextBtn').disabled = true;
        }

        // –í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞
        function selectOption(index) {
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            options[index].classList.add('selected');
            document.getElementById('nextBtn').disabled = false;
        }

        // –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
        async function nextQuestion() {
            const selectedOption = document.querySelector('.option.selected');
            if (!selectedOption) return;

            const answerText = selectedOption.textContent.trim();
            answers.push(answerText);
            currentQuestion++;

            if (currentQuestion < totalQuestions) {
                showLoading('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞...');
                await generateQuestion();
            } else {
                await showResults();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        async function showResults() {
            document.getElementById('questionSection').style.display = 'none';
            showLoading('–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã...');

            try {
                const response = await fetch(`${SERVER_URL}/api/generate-result`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        answers: answers
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                }

                hideLoading();
                document.getElementById('resultSection').style.display = 'block';
                document.getElementById('resultDescription').innerHTML = 
                    data.choices[0].message.content.replace(/\n/g, '<br>');

            } catch (error) {
                console.error('Error:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ' + error.message);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –µ—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
                document.getElementById('resultDescription').innerHTML = `
                    –ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏, —á—Ç–æ –≤–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –∞—Ä–æ–º–∞—Ç—ã —Å –Ω–æ—Ç–∞–º–∏:<br><br>
                    ‚Ä¢ <strong>–°–≤–µ–∂–∏–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –∏ –∑–µ–ª–µ–Ω—ã–µ –∞–∫–∫–æ—Ä–¥—ã</strong> - –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ –±–æ–¥—Ä–æ—Å—Ç–∏<br>
                    ‚Ä¢ <strong>–¶–≤–µ—Ç–æ—á–Ω—ã–µ –∏ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ –Ω–æ—Ç—ã</strong> - –¥–ª—è —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è<br>
                    ‚Ä¢ <strong>–î—Ä–µ–≤–µ—Å–Ω—ã–µ –∏ –º—É—Å–∫—É—Å–Ω—ã–µ –±–∞–∑—ã</strong> - –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –∑–∞–≥–∞–¥–æ—á–Ω–æ—Å—Ç–∏<br><br>
                    –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ—Å–µ—Ç–∏—Ç—å –ø–∞—Ä—Ñ—é–º–µ—Ä–Ω—ã–π –±—É—Ç–∏–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Ä–æ–º–∞—Ç–æ–≤!
                `;
                document.getElementById('resultSection').style.display = 'block';
                hideLoading();
            }
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
        function restartTest() {
            currentQuestion = 0;
            answers = [];
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('questionSection').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞...');
            generateQuestion();
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('questionSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('questionSection').style.display = 'block';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            hideLoading();
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // –°–∫—Ä—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø—Ä–∏ –∫–ª–∏–∫–µ
        document.getElementById('errorMessage').onclick = function() {
            this.style.display = 'none';
        };

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
        window.addEventListener('online', function() {
            const errorDiv = document.getElementById('errorMessage');
            if (errorDiv.textContent.includes('—Å–µ—Ç–∏') || errorDiv.textContent.includes('Network')) {
                errorDiv.style.display = 'none';
                if (currentQuestion === 0) {
                    generateQuestion();
                }
            }
        });

        window.addEventListener('offline', function() {
            showError('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
        });
    </script>
</body>
</html>
